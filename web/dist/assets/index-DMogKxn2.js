import{r as h,u as R,o as _,j as e,s as I,t as a,c as W,d as Y}from"./index-RDh5ZlVD.js";import{u as j,a as v,c as C,F as S,b,d as N,f as w,I as k,g as F,B as p,A as G,C as J,h as K,i as O,j as Q,k as X}from"./input-Byn5FOX3.js";import{v as Z,r as ee}from"./auth-service-C-jMAfeD.js";import{c as x}from"./createLucideIcon-BARJWKoF.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],te=x("arrow-left",se);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],oe=x("copy",ae);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],E=x("loader-circle",ie);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],P=x("mail",ce),re=globalThis.console,ne=_({email:I().email("Please enter a valid email")}),le=_({code:I().min(1,"Please enter a login token")});function de({className:n,redirectTo:l,step:f,setStep:L,...A}){const[d,m]=h.useState(!1),[T,V]=h.useState("email"),[q,z]=h.useState(""),B=R(),M=f??T,g=L??V,y=j({resolver:v(ne),defaultValues:{email:""}}),u=j({resolver:v(le),defaultValues:{code:""}});async function $(o){m(!0),z(o.email);try{const t=await ee(o.email),i=t.data?.code;t?.status?.toLowerCase()==="ok"||!!i?(a.success("Verification code sent!",{description:i?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Your code is: ",i]}),e.jsx(p,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:async c=>{c.preventDefault(),c.stopPropagation();const r=i;try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(r),a.success("Code copied to clipboard!");else{const s=document.createElement("textarea");s.value=r,s.style.position="fixed",s.style.left="-999999px",s.style.top="-999999px",document.body.appendChild(s),s.focus(),s.select();try{if(document.execCommand("copy"))a.success("Code copied to clipboard!");else throw new Error("Copy command failed")}finally{document.body.removeChild(s)}}}catch(s){re?.error?.("Failed to copy code:",s),a.error("Failed to copy code",{description:"Please copy manually: "+r})}},children:e.jsx(oe,{className:"h-3 w-3"})})]}):"Check your email for the verification code."}),g("verification")):a.error("Failed to send verification code",{description:t.message||"Please try again or contact support."})}catch{a.error("Failed to send verification code",{description:"Please try again or contact support."})}finally{m(!1)}}async function D(o){m(!0);try{const t=await Z(o.code);if(t.success&&t.login){a.success("Welcome back!",{description:"Successfully signed in"}),await new Promise(r=>setTimeout(r,250));const{hasIdentity:i}=W.getState(),c=l||"/";i?window.location.href=c:B({to:"/identity",search:{redirect:c},replace:!0})}else a.error("Invalid verification code",{description:t.message||"Please check your email and try again."})}catch{a.error("Verification failed",{description:"Please try again or contact support."})}finally{m(!1)}}function H(){g("email"),u.reset()}return M==="verification"?e.jsxs("div",{className:C("grid gap-4",n),children:[e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Enter Login Code"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Paste your login code"}),e.jsx("p",{className:"text-sm font-medium",children:q})]}),e.jsx(S,{...u,children:e.jsxs("form",{onSubmit:u.handleSubmit(D),className:"grid gap-4",children:[e.jsx(b,{control:u.control,name:"code",render:({field:o})=>e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(k,{placeholder:"Code",className:"text-center font-mono tracking-wider",...o})}),e.jsx(F,{})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{type:"submit",className:"w-full",disabled:d,children:[d?e.jsx(E,{className:"animate-spin"}):e.jsx(P,{}),"Authenticate"]}),e.jsxs(p,{type:"button",variant:"ghost",onClick:H,className:"w-full",children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"Back to email"]})]})]})})]}):e.jsx(S,{...y,children:e.jsxs("form",{onSubmit:y.handleSubmit($),className:C("grid gap-3",n),...A,children:[e.jsx(b,{control:y.control,name:"email",render:({field:o})=>e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(k,{placeholder:"Email",...o})}),e.jsx(F,{})]})}),e.jsxs(p,{className:"mt-2",disabled:d,children:[d?e.jsx(E,{className:"animate-spin"}):e.jsx(P,{}),"Send Verification Code"]})]})})}function me(){const{redirect:n}=Y({from:"/"}),[l,f]=h.useState("email");return e.jsx(G,{children:e.jsxs(J,{className:"gap-4",children:[l==="email"&&e.jsxs(K,{children:[e.jsx(O,{className:"text-lg tracking-tight",children:"Sign in"}),e.jsx(Q,{children:"Enter your email address"})]}),e.jsx(X,{children:e.jsx(de,{redirectTo:n,step:l,setStep:f})})]})})}const ye=me;export{ye as component};
